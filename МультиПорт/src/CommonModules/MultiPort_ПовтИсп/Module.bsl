
#Область РаботаСИсходящимиСообщениями //*******************************************

Функция ОпределитьТипИсходящегоСообщения(МнемокодСообщения) Экспорт

	//Запрос=
	
КонецФункции

Функция ВнешняяСистемаПоТипуИсходящегоСообщения(ТипИсходящегоСообщения) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ТипИсходящегоСообщения.Владелец КАК ВнешняяСистема
	|ИЗ
	|	Справочник.MultiPort_ТипИсходящегоСообщения КАК ТипИсходящегоСообщения
	|ГДЕ
	|	ТипИсходящегоСообщения.Ссылка = &ТипИсходящегоСообщения";
	Запрос.УстановитьПараметр("ТипИсходящегоСообщения", ТипИсходящегоСообщения);
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();
	
	Если Выборка.Следующий() Тогда
		Возврат Выборка.ВнешняяСистема;				
	Иначе
		Возврат Неопределено;
	КонецЕсли;	
	
КонецФункции

#КонецОбласти // РаботаСИсходящимиСообщениями

#Область РаботаСВходящимиСообщениями //*******************************************

Функция ОпределитьТипВходящегоСообщения(МнемокодСообщения, ВнешняяСистема) Экспорт

	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	MultiPort_ТипВходящегоСообщения.Ссылка КАК Ссылка
	|ИЗ
	|	Справочник.MultiPort_ТипВходящегоСообщения КАК MultiPort_ТипВходящегоСообщения
	|ГДЕ
	|	MultiPort_ТипВходящегоСообщения.ТехническоеИмя = &ТехническоеИмя
	|	И MultiPort_ТипВходящегоСообщения.Владелец = &ВнешняяСистема";
	Запрос.УстановитьПараметр("ВнешняяСистема", ВнешняяСистема);
	Запрос.УстановитьПараметр("ТехническоеИмя", МнемокодСообщения);
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();
	
	Если Выборка.Следующий() Тогда
		Возврат Выборка.Ссылка;
	Иначе	
		Возврат Неопределено;		
	КонецЕсли;
	
КонецФункции

Функция ВнешняяСистемаПоТипуВходящегоСообщения(ТипВходящегоСообщения) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ТипВходящегоСообщения.Владелец КАК ВнешняяСистема
	|ИЗ
	|	Справочник.MultiPort_ТипВходящегоСообщения КАК ТипВходящегоСообщения
	|ГДЕ
	|	ТипВходящегоСообщения.Ссылка = &ТипВходящегоСообщения";
	Запрос.УстановитьПараметр("ТипВходящегоСообщения", ТипВходящегоСообщения);
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();
	
	Если Выборка.Следующий() Тогда
		Возврат Выборка.ВнешняяСистема;				
	Иначе
		Возврат Неопределено;
	КонецЕсли;	
	
КонецФункции

Функция СверитьПользователяВнешнейСистемы(ВнешняяСистема, ТекущийПользователь) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	MultiPort_ВнешниеСистемы.ПользовательСоединения КАК ПользовательСоединения
	|ИЗ
	|	ПланОбмена.MultiPort_ВнешниеСистемы КАК MultiPort_ВнешниеСистемы
	|ГДЕ
	|	MultiPort_ВнешниеСистемы.Ссылка = &ВнешняяСистема";
	Запрос.УстановитьПараметр("ВнешняяСистема", ВнешняяСистема);
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();
	
	Если Выборка.Следующий() Тогда
		Если ЗначениеЗаполнено(Выборка.ПользовательСоединения) Тогда
			Возврат Выборка.ПользовательСоединения = ТекущийПользователь;
		Иначе
			Возврат Истина;
		КонецЕсли;	
	Иначе
		Возврат Ложь;
	КонецЕсли;		
	
КонецФункции	

#КонецОбласти // РаботаСВходящимиСообщениями
